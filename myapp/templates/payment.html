<script
        src="https://www.paypal.com/sdk/js?client-id=AantCxTo8S2RR6e6aRbMV29ZqXwX26bleXFuNq9HmLc2LdAGpxg3SLwKwfypZRutj-6QNoyy1givplZf"> // Required. Replace SB_CLIENT_ID with your sandbox client ID.
</script>

<script src="https://js.stripe.com/v3/"></script>
<style>

    .StripeElement {
        box-sizing: border-box;

        height: 40px;
        width: 500px;
        padding: 10px 12px;

        border: 1px solid transparent;
        border-radius: 4px;
        background-color: white;

        box-shadow: 0 1px 3px 0 #e6ebf1;
        -webkit-transition: box-shadow 150ms ease;
        transition: box-shadow 150ms ease;
    }

    .StripeElement--focus {
        box-shadow: 0 1px 3px 0 #cfd7df;
    }

    .StripeElement--invalid {
        border-color: #fa755a;
    }

    .StripeElement--webkit-autofill {
        background-color: #fefde5 !important;
    }
</style>
{% extends 'base.html' %}
{% load static %}
{% block content %}
<section id="hero">

    <div class="container">
        <div class="row">
            <div class="col-lg-7 pt-5 pt-lg-0 order-2 order-lg-1 d-flex align-items-center">
                <div data-aos="zoom-out">
                    <h1>
                        Congrats! Your files are ready
                        <span>B2B Databank</span></h1>
                    <h2>We host databank of all the business in your city, state or country</h2>
                    <div class="text-center text-lg-left">
                        <a href="#about" class="btn-get-started scrollto">Get Started</a>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 order-1 order-lg-2 hero-img" data-aos="zoom-out" data-aos-delay="300">
                <img src="{% static 'myapp/assets/img/hero-img.png' %}" class="img-fluid animated" alt="">
            </div>
        </div>
    </div>

    <svg class="hero-waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
         viewBox="0 24 150 28 " preserveAspectRatio="none">
        <defs>
            <path id="wave-path" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z">
        </defs>
        <g class="wave1">
            <use xlink:href="#wave-path" x="50" y="3" fill="rgba(255,255,255, .1)">
        </g>
        <g class="wave2">
            <use xlink:href="#wave-path" x="50" y="0" fill="rgba(255,255,255, .2)">
        </g>
        <g class="wave3">
            <use xlink:href="#wave-path" x="50" y="9" fill="#fff">
        </g>
    </svg>

</section><!-- End Hero -->

<main id="main">
    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-2 ">
                    <h3>Checkout</h3>
                </div>
                <div class="col-md-2">
                    <h4>{{charge}} $</h4>

                </div>
            </div>
        </div>
        <div class="container">

        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-3 order-md-2 mb-4">
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Your cart</span>
                    </h4>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0">{{total}} Address</h6>
                                <small class="text-muted">20¢ * {{ total }} address </small>
                            </div>
                            <span class="text-muted">    {{charge}} $
</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0">19% tax </h6>
                                <small class="text-muted">{{ charge }}$ + {{tax}}$  </small>
                            </div>
                            <span class="text-muted">    {{totalprice}} $
</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Total (USD)</span>
                            <strong> {{totalprice}} $</strong>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4 order-md-1">
<div class="checkout-form-wrap">
                        <div class="checkout-heading">Bitte akzeptieren Sie</div>
                        <div class="form-group form-checkbox-group field-payment-termsandconditionagreement has-success">

<input type="hidden" name="Payment[termsAndConditionAgreement]" value="0"><label class="form-checkbox"><input type="checkbox" id="payment-termsandconditionagreement" class="form-checkbox-input" name="Payment[termsAndConditionAgreement]" value="1" _checkout-privacy-fields="" aria-invalid="false"> <span class="form-checkbox-checkmark text-justify">Ich habe die <a href="/agb" target="_blank">Allgemeinen Geschäfts­bedingungen</a> gelesen und akzeptiere diese.</span></label>

<div class="form-error checkout-checkbox-error"> Sie müssen unsere AGB akzeptieren.</div>
</div>                        <div class="form-group form-checkbox-group field-payment-deliveryagreement has-error">

<input type="hidden" name="Payment[deliveryAgreement]" value="0"><label class="form-checkbox"><input type="checkbox" id="payment-deliveryagreement" class="form-checkbox-input" name="Payment[deliveryAgreement]" value="1" _checkout-privacy-fields="" aria-invalid="true"> <span class="form-checkbox-checkmark text-justify">Ich stimme aus­drücklich zu, dass mit der Aus­führung des Vertrags vor Ablauf der Widerrufs­frist begonnen wird. Mir ist bekannt, dass ich damit ab Beginn der Vertrags­ausführung mein Widerrufs­recht verliere.</span></label>

<div class="form-error checkout-checkbox-error">Sie müssen das Widerrufsrecht akzeptieren.</div>
</div>                        <div class="form-group form-checkbox-group field-payment-gdpragreement required has-error">

<input type="hidden" name="Payment[gdprAgreement]" value="0"><label class="form-checkbox"><input type="checkbox" id="payment-gdpragreement" class="form-checkbox-input" name="Payment[gdprAgreement]" value="1" _checkout-privacy-fields="" aria-invalid="true"> <span class="form-checkbox-checkmark text-justify">Ich habe die <a href="/datenschutz-einwilligungserklaerung" target="_blank">Datenschutzerklärung</a> zur Kenntnis ge­nommen und erkläre mich damit ein­verstanden, dass die von mir einge­gebenen Daten elektronisch über­mittelt, er­hoben und ge­speichert werden. Ins­besondere habe ich zur Kenntnis genommen, dass zur Er­füllung des Ver­trages die Links zu den von mir aus­gewählten Social-Media-Inhalten an Unter­auftrag­nehmer in Länder außer­halb der Euro­päischen Union bzw. des Euro­päischen Wirtschafts­raumes übermittelt werden, so dass hierfür ein an­gemessenes Datenschutz­niveau nicht ge­währleistet werden kann. Dadurch be­steht ein erhöhtes Risiko der Ver­arbeitung dieser Daten entgegen den datenschutz­rechtlichen Vor­gaben der DSGVO und des BDSG. Ich habe die Einzel­heiten hier­zu in der <a href="/datenschutz-einwilligungserklaerung" target="_blank">Datenschutzerklärung</a> zur Kenntnis genommen und willige aus­drücklich in eine derartige Er­hebung, Speicherung und Ver­arbeitung ein­schließlich Über­mittlung ein.</span></label>

<div class="form-error checkout-checkbox-error">Sie müssen die Datenschutzerklärung akzeptieren.</div>
</div>                                                     <div class="checkout-note"><span class="text-bold"></span></div>
<!--                                                <button type="submit" class="btn checkout-btn-primary wide loading disabled" _checkout-submit="">Weiter zur Bezahlung</button>                    -->
                </div>
                </div>

                <div class="col-md-5 order-md-1">

                    <form class="needs-validation" novalidate="" action="/charge" method="post" id="payment-form">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="email">Email <span class="text-muted">(Optional)</span></label>
                            <input type="email" class="form-control" name="email" id="email"
                                   placeholder="you@example.com">
                            <div class="invalid-feedback">
                                Please enter a valid email address for shipping updates.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="address" name="address"
                                   placeholder="1234 Main St" required="">
                            <div class="invalid-feedback">
                                Please enter your shipping address.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
                            <input type="text" class="form-control" id="address2" name="address2"
                                   placeholder="Apartment or suite">
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cc-name">Name on card</label>
                                <input type="text" class="form-control" id="cc-name" name="name" placeholder=""
                                       required="">
                                <small class="text-muted">Full name as displayed on card</small>
                                <div class="invalid-feedback">
                                    Name on card is required
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="cc-name">Company Name</label>
                                <input type="text" class="form-control" id="company" name="company" placeholder=""
                                       required="">
                                <small class="text-muted">Company name </small>
                                <div class="invalid-feedback">
                                   Compnay Name on card is required
                                </div>
                            </div>
                        </div>
                        <hr class="mb-4">

                    <div class="container">
                        <div id="paypal-button-container"></div>

<!--                        <p class="subtitle fancy"><span style="font-size: 50px">OR</span></p>-->
                    </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="preloader2"></div>

    </section>
    <script>
    function validate(val1,val2,val3,val4,val5) {
         console.log(val1,val2,val3,val4,val5)
if(!val1 && !val2 && !val3 && !val4 && !val5){

    return true
}else{
    console.log(false)
    return false
}
    }
        // using jQuery

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        paypal.Buttons({
            onInit: function (data, actions) {

                // Disable the buttons
                actions.disable();
                var error=true;
                var namedError=true;
                var addressError=true
                var companyError=true
                var checkboxError=true
                const email = document.getElementById("email");
              const address = document.getElementById("address");
              const address2 = document.getElementById("address2");
              const name = document.getElementById("cc-name");
const company = document.getElementById("company");

company.addEventListener("input", function (event) {
console.log(event)
if(company.value.trim().length<5){
    companyError=true
actions.disable()

if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()

}else{
    companyError=false

if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()

}
})

address.addEventListener("input", function (event) {
console.log(event)
if(address.value.trim().length<5){
    addressError=true
actions.disable()

if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()

}else{
    addressError=false

if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()
}
})

name.addEventListener("input", function (event) {
console.log(event)
if(name.value.trim().length<5){
    namedError=true
    actions.disable()

}else{
    namedError=false
if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()

}
})

email.addEventListener("input", function (event) {
console.log(event)
  if (email.validity.typeMismatch || email.value.length<5) {
      error=true
actions.disable()
    email.setCustomValidity("I am expecting an e-mail address!");
  } else {
      error=false

if(    validate(namedError,companyError,error,addressError,checkboxError))
    actions.enable()
    email.setCustomValidity("");
  }
});


                document.querySelector('#payment-gdpragreement')
                    .addEventListener('change', function (event) {
if(document.querySelector('#payment-deliveryagreement').checked  && document.querySelector('#payment-termsandconditionagreement').checked && event.target.checked){
                                console.log('check')
    checkboxError=false
    if(validate(namedError,companyError,error,addressError,checkboxError)) actions.enable()
                           }else {
checkboxError=true
                            actions.disable();
                           }
                        // Enable or disable the button when it is checked or unchecked
                        if (event.target.checked) {
                document.querySelector('.field-payment-gdpragreement').classList.remove('has-error')
                            document.querySelector('.field-payment-gdpragreement .form-error').style.display='none'

                document.querySelector('.field-payment-gdpragreement').classList.add('has-success')
                        } else {

                document.querySelector('.field-payment-gdpragreement').classList.remove('has-success')
                           document.querySelector('.field-payment-gdpragreement .form-error').style.display='inline-block'

                document.querySelector('.field-payment-gdpragreement').classList.add('has-error')
                       checkboxError=true
                            actions.disable();
                        }
                    })
                // Listen for changes to the checkbox
                document.querySelector('#payment-deliveryagreement')
                    .addEventListener('change', function (event) {
if(
                document.querySelector('#payment-gdpragreement').checked  && document.querySelector('#payment-termsandconditionagreement').checked && event.target.checked){
                                console.log('check')
    checkboxError=false
    if(validate(namedError,companyError,error,addressError,checkboxError))actions.enable()
                                }else {
checkboxError=true
                            actions.disable();
                           }
                        // Enable or disable the button when it is checked or unchecked
                        if (event.target.checked) {
                document.querySelector('.field-payment-deliveryagreement').classList.remove('has-error')
                            document.querySelector('.field-payment-deliveryagreement .form-error').style.display='none'

                document.querySelector('.field-payment-deliveryagreement').classList.add('has-success')
                        } else {
                document.querySelector('.field-payment-deliveryagreement').classList.remove('has-success')
                           document.querySelector('.field-payment-deliveryagreement .form-error').style.display='inline-block'

                document.querySelector('.field-payment-deliveryagreement').classList.add('has-error')
checkboxError=true
                            actions.disable();
                        }
                    })
                // Listen for changes to the checkbox
                document.querySelector('#payment-termsandconditionagreement')
                    .addEventListener('change', function (event) {
if(
                document.querySelector('#payment-gdpragreement').checked  && document.querySelector('#payment-deliveryagreement').checked && event.target.checked){
    checkboxError=false
    if(validate(namedError,companyError,error,addressError,checkboxError))actions.enable()
                               }else {
checkboxError=true
                            actions.disable();
                           }
                        // Enable or disable the button when it is checked or unchecked
                        if (event.target.checked) {
                document.querySelector('.field-payment-termsandconditionagreement').classList.remove('has-error')
                            document.querySelector('.field-payment-termsandconditionagreement .form-error').style.display='none'

                document.querySelector('.field-payment-termsandconditionagreement').classList.add('has-success')

                        } else {

                document.querySelector('.field-payment-termsandconditionagreement').classList.remove('has-success')
                           document.querySelector('.field-payment-termsandconditionagreement .form-error').style.display='inline-block'

                document.querySelector('.field-payment-termsandconditionagreement').classList.add('has-error')
checkboxError=true
                            actions.disable();
                        }
                    });
            }

            ,
            createOrder: function (data, actions) {
                // This function sets up the details of the transaction, including the amount and line item details.
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '{{totalprice}}'
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                var div = document.createElement("div");
                div.id = "preloader";
                document.getElementById("main").appendChild(div)

                // This function captures the funds from the transaction.
                alert(document.getElementById('email').value)
                alert(document.getElementById('address').value)
                alert(document.getElementById('address2').value)
                alert(document.getElementById('cc-name').value)
                return $.ajax({
                    url: 'paypal-checkout/' + data.orderID + "/",
                    data: {'email': document.getElementById('email').value, 'address': document.getElementById('address').value,'company': document.getElementById('company').value, 'address2': document.getElementById('address2').value, 'name': document.getElementById('cc-name').value},
                    dataType: 'json',
                    method: 'post',
                    error: function (err) {


                    },
                    success: function (data) {

                //
                        if (data.msg == 'success') {
 window.location = '/success'

                        } else {

                                    window.location = '/pay'

                        }

                    },

                });

                //             return fetch('paypal-checkout/' + data.orderID + "/", {
                //                 method: 'POST',
                //                 headers: {
                //
                //                     "X-CSRFToken": getCookie("csrftoken"),
                //                     "Accept": "application/json",
                //                     "Content-Type": "application/json"
                //                 },
                //                 body: JSON.stringify({ "user": {
                //   "email" : "as",
                //   "password" : "SA"
                // }}),
                //             }).then(function (res) {
                //                 return res.json();
                //             }).then(function (details) {
                //                 if (details.msg == 'success') {
                //
                //                     // alert('Transaction funds captured from ' + details.msg);
                //                     window.location = '/success'
                //                 } else {
                //                     window.location = '/pay'
                //                 }
                //             })

            }
        }).render('#paypal-button-container');
        //This function displays Smart Payment Buttons on your web page.
    </script>

    <script>


        var stripe = Stripe('pk_test_qIIXgL0oRGXrLhvcPr72l8ek009rZG3OtX');

        // Create an instance of Elements.
        var elements = stripe.elements();

        // Custom styling can be passed to options when creating an Element.
        // (Note that this demo uses a wider set of styles than the guide below.)
        var style = {
            base: {
                color: '#32325d',
                fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
                fontSmoothing: 'antialiased',
                fontSize: '16px',
                '::placeholder': {
                    color: '#aab7c4'
                }
            },
            invalid: {
                color: '#fa755a',
                iconColor: '#fa755a'
            }
        };

        // Create an instance of the card Element.
        var card = elements.create('card', {style: style});

        // Add an instance of the card Element into the `card-element` <div>.
        card.mount('#card-element');

        // Handle real-time validation errors from the card Element.
        card.addEventListener('change', function (event) {
            var displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
            } else {
                displayError.textContent = '';
            }
        });

        // Handle form submission.
        var form = document.getElementById('payment-form');
        console.log("sad" + form)
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            var div = document.createElement("div");
            div.id = "preloader";
// div.appendChild(document.createElement())
            document.getElementById("main").appendChild(div)
            stripe.createToken(card).then(function (result) {
                if (result.error) {
                    // Inform the user if there was an error.
                    var errorElement = document.getElementById('card-errors');
                    errorElement.textContent = result.error.message;
                } else {
                    // Send the token to uur server.
                    stripeTokenHandler(result.token);
                }
            });
        });

        // Submit the form with the token ID.
        function stripeTokenHandler(token) {
            // Insert the token ID into the form so it gets submitted to the server
            var form = document.getElementById('payment-form');
            var hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripeToken');
            hiddenInput.setAttribute('value', token.id);
            form.appendChild(hiddenInput);

            // Submit the form
            form.submit();
        }
    </script>
</main>
{% endblock content %}
